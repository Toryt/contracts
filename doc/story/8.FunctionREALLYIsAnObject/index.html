<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>A Function is Really an Object</title>
  <link href="../../lib/prism/prism.css" rel="stylesheet"/>
  <link href="../story.css" rel="stylesheet"/>
</head>
<body>

<div class="navigate prev"><a href="../7.FunctionIsAnObject_Reprise/index.html">Previous</a></div>

<p>But if <a href="#code.1-11"><code class="language-javascript">fibonacci.verify(conditions, â€¦)</code></a>
  is a function of the object &quot;fibonacci&quot;, it is actually a <em>method</em>. And
  this object &quot;fibonacci&quot; already has 2 properties,
  <a href="#fibonacciContract.1-4"><code class="language-javascript">fibonacci.pre</code></a>
  and <a href="#fibonacciContract.5-9"><code class="language-javascript">fibonacci.post</code></a>.
  The <a href="#code.1-11"><code class="language-javascript">fibonacci.verify()</code></a>
  method should be able to use the collections of conditions directly. They are
  <code class="language-javascript">this</code>-properties (shown out-of-order here).</p>

<pre id="fibonacciContract" class="line-numbers" data-src="../fibonacciContract.js"
     data-line="1-4,5-9"></pre>

<p>The <a href="#code.1-11"><code class="language-javascript">fibonacci.verify()</code></a>
  method is changed so that <a href="#code.36">it accesses the collections of conditions as
  <code class="language-javascript">this</code>-properties</a>. Variation is necessary
  to choose the appropriate set for pre- and postconditions. We regain that by
  adding a <code class="language-javascript">conditionPropertyName</code>
  parameter to the <a href="#code.1-11"><code class="language-javascript">fibonacci.verify()</code></a>
  method.</p>

<pre id="code" class="line-numbers" data-src="code.js" data-line="1-11,3,13,14"></pre>

<p>We could call it this way directly from the <a href="#fibonacci.1-22">main function</a>, but
  I believe it is cleaner to introduce 2 specific methods for that,
  <a href="#code.13"><code class="language-javascript">fibonacci.verifyPre()</code></a> and
  <a href="#code.14"><code class="language-javascript">fibonacci.verifyPost()</code></a>,
  as partial evaluation of
  <a href="#code.1-11"><code class="language-javascript">fibonacci.verify()</code></a>.</p>

<pre id="fibonacci" class="line-numbers" data-src="../fibonacciDoctored.js" data-line="1-22,3,19"></pre>

<p>Done.</p>

<p>This is a true refactor. Contract definitions are not changed, nothing changes in the output of
  <code class="language-javascript">fibonacci(&quot;a&quot;)</code>:</p>

<div id="prism-eval-output-fibonacciWithA"></div>

<p>And nothing changes in the output of the of <code class="language-javascript">fibonacci</code>
  with the integers from -1 to 9:</p>

<div id="prism-eval-output-fibonacciWithI"></div>


<div class="navigate next"><a href="../9.ObjectsHavePrototypes/index.html">Next</a></div>

<div id="prism-eval-output"></div> <!-- not used -->


<script src="../../lib/prism/prism.js"></script>
<script src="../fibonacciDoctored.js"></script>
<script src="../fibonacciContract.js"></script>
<script src="code.js"></script>
<script src="../execFibonacci.js"></script>

</body>
</html>
