const build = `manual ${new Date().toISOString()}`
console.log(`build: ${build}`)

const capabilitiesBase = {
  project: 'Toryt contracts',
  build: build,
  'browserstack.user': process.env.BROWSERSTACK_USERNAME,
  'browserstack.key': process.env.BROWSERSTACK_ACCESS_KEY
}

const osVersion = {
  'OS X': 'High Sierra',
  'Windows': '10'
}

/* We only test the last version of every combination, by not specifying any version.
   By running the tests every week, we stay compatible. */
const desktop = [
/*
  {browser: 'Chrome', os: 'OS X', os_version: 'High Sierra'}, // NOTE initially ok
  {browser: 'Chrome', os: 'Windows'}, // NOTE initially ok
  {browser: 'Firefox', os: 'OS X'}, // MUDO POST /session/9e04da0e258310d9171fcc316331e240866d73e7/timeouts/async_script did not match a known command
  {browser: 'Firefox', os: 'Windows'}, // MUDO POST /session/093906dda2505ee62ac0621e8bf1a4adcae48e35/timeouts/async_script did not match a known command
  {browser: 'Safari', os: 'OS X'}, // MUDO stops after errors
  {browser: 'Edge', os: 'Windows'} // MUDO 3 fails
*/
]
  .map(d => ({
    name: `${d.browser} - ${d.os}`,
    capabilities: Object.assign(d, capabilitiesBase, {os_version: osVersion[d.os]})
  }))

const mobile = [
/*
  'Samsung Galaxy S9', // NOTE initially ok
  'Samsung Galaxy Note 4', // NOTE initially ok
  'iPhone X', // MUDO many errors
  'iPad Pro' // MUDO many errors
*/
]
  .map(m => ({
    name: m,
    capabilities: Object.assign(
      {
        device: m,
        real_mobile: true
      },
      capabilitiesBase
    )
  }))

const definitions = desktop.concat(mobile)
console.log(`${definitions.length}:`, definitions.map(d => d.name).join(', '))

module.exports = {
  "hostname": "hub-cloud.browserstack.com",
  "port": 80,
  "browsers": definitions
}
